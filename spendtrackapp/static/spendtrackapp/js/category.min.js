class Category{constructor(id,name,pid){this.id=id;this.name=name;this.pid=pid;this.children=[];this.parent=null;this.level=1}isLeaf(){return this.children.length===0}isRoot(){return this.pid==="None"}setDescendantsLevel(){for(let i=0;i<this.children.length;i++){let child=this.children[i];child.level=this.level+1;child.setDescendantsLevel()}}toHtml(catFieldId,allowNonLeaf=false){let innerDiv=$('<div class="level-'+this.level+'" id="cat-'+this.id+'">').text(this.name);let div=$('<div class="category">').append(innerDiv);if(this.isLeaf()||allowNonLeaf){div.addClass("leaf");div.click(Category.generateSelectCategoryFunc(catFieldId,this))}let divs=[div];for(let i=0;i<this.children.length;i++)divs=divs.concat(this.children[i].toHtml(catFieldId,allowNonLeaf));return divs}static nullCategoryOption(){return new Category("empty","Select a category",null)}static allCategoryOption(){return new Category(null,"All categories",null)}static createHierarchy(categoryArray){let map={};for(let i=0;i<categoryArray.length;i++){let cat=categoryArray[i];map[cat.id]=cat}let roots=[];for(let i=0;i<categoryArray.length;i++){let cat=categoryArray[i];if(cat.isRoot()){roots.push(cat)}else{let parent=map[cat.pid];if(parent!==undefined)parent.children.push(cat);cat.parent=parent}}for(let i=0;i<roots.length;i++)roots[i].setDescendantsLevel();return roots}static getCategoryHiddenData(){let cats=[];let n=categoryHiddenData.id.length;for(let i=0;i<n;i++){cats.push(new Category(categoryHiddenData.id[i],categoryHiddenData.name[i],categoryHiddenData.pid[i]))}return cats}static toHierarchyHtml(catFieldId,enableAllCategoryOption,allowNonLeaf=false){let cats=this.getCategoryHiddenData();let roots=this.createHierarchy(cats);if(enableAllCategoryOption)roots.splice(0,0,Category.allCategoryOption());let html=[];for(let i=0;i<roots.length;i++)html=html.concat(roots[i].toHtml(catFieldId,allowNonLeaf));return html}static toDropdownMenu(catFieldId,enableAllCategoryOption=true,allowNonLeaf=false){return $('<div class="select">').append('<input type="hidden" id="'+catFieldId+'" autocomplete="off">').append($('<div class="select-btn clickable">').click(Category.generateShowDropDownFunc(catFieldId)).append('<span class="clickable" id="display-'+catFieldId+'">').append('<span class="clickable">&#x25BC</span>')).append($('<div  class="select-content" id="select-'+catFieldId+'">').append(Category.toHierarchyHtml(catFieldId,enableAllCategoryOption,allowNonLeaf)))}static generateShowDropDownFunc(catFieldId){return function(){$("#select-"+catFieldId).toggleClass("show")}}static generateSelectCategoryFunc(catFieldId,category){return function(){$("#display-"+catFieldId).text(category.name);$("#"+catFieldId).val(category.id)}}static clearSelectCategoryField(catFieldId){Category.generateSelectCategoryFunc(catFieldId,Category.nullCategoryOption())()}}window.onclick=function(event){if(!event.target.matches(".clickable"))$(".select-content").removeClass("show")};
